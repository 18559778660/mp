/**
 * Author: phantom
 * Date: 2025-12-16 15:57
 */
(function(S,x){typeof exports=="object"&&typeof module<"u"?x(exports):typeof define=="function"&&define.amd?define(["exports"],x):(S=typeof globalThis<"u"?globalThis:S||self,x(S.__obtelemetry_phantom__={}))})(this,function(S){"use strict";const z="https://cube.weixinbridge.com/cube/report/reportbizdata?f=json",v="__lsb__watermark__container__",F="__wx_phantom_mark__",k="__obtelemetry_phantom_sessionId__";let P;function X(t){let n="Unknown",r="Unknown",e="Unknown";if(/Windows NT 10/.test(t))e="Windows 10/11";else if(/Windows NT 6.3/.test(t))e="Windows 8.1";else if(/Windows NT 6.2/.test(t))e="Windows 8";else if(/Windows NT 6.1/.test(t))e="Windows 7";else if(/Windows NT 6.0/.test(t))e="Windows Vista";else if(/Windows NT 5.1/.test(t))e="Windows XP";else if(/Windows/.test(t))e="Windows";else if(/Mac OS X (\d+[._]\d+)/.test(t)){const o=t.match(/Mac OS X (\d+[._]\d+)/);o?e=`macOS ${o[1].replace("_",".")}`:e="macOS"}else if(/Android (\d+\.\d+)/.test(t)){const o=t.match(/Android (\d+\.\d+)/);o?e=`Android ${o[1]}`:e="Android"}else if(/iPhone OS (\d+[._]\d+)/.test(t)){const o=t.match(/iPhone OS (\d+[._]\d+)/);o?e=`iOS ${o[1].replace("_",".")}`:e="iOS"}else if(/iPad.*OS (\d+[._]\d+)/.test(t)){const o=t.match(/OS (\d+[._]\d+)/);o?e=`iPadOS ${o[1].replace("_",".")}`:e="iPadOS"}else/Linux/.test(t)?e="Linux":/CrOS/.test(t)&&(e="Chrome OS");if(/Chrome\/(\d+\.\d+\.\d+\.\d+)/.test(t)&&!/Edg\//.test(t)&&!/OPR\//.test(t)){n="Chrome";const o=t.match(/Chrome\/(\d+\.\d+\.\d+\.\d+)/);o&&(r=o[1])}else if(/Edg\/(\d+\.\d+\.\d+\.\d+)/.test(t)){n="Edge";const o=t.match(/Edg\/(\d+\.\d+\.\d+\.\d+)/);o&&(r=o[1])}else if(/OPR\/(\d+\.\d+\.\d+\.\d+)/.test(t)){n="Opera";const o=t.match(/OPR\/(\d+\.\d+\.\d+\.\d+)/);o&&(r=o[1])}else if(/Firefox\/(\d+\.\d+)/.test(t)){n="Firefox";const o=t.match(/Firefox\/(\d+\.\d+)/);o&&(r=o[1])}else if(/Safari\/(\d+\.\d+)/.test(t)&&!/Chrome/.test(t)){n="Safari";const o=t.match(/Version\/(\d+\.\d+)/);o&&(r=o[1])}else if(/MSIE (\d+\.\d+)/.test(t)||/Trident\/.*rv:(\d+\.\d+)/.test(t)){n="IE";const o=t.match(/(?:MSIE |rv:)(\d+\.\d+)/);o&&(r=o[1])}return{browser:n,browserVersion:r,browserOS:e}}function q(){if(typeof window>"u"||typeof navigator>"u")throw new Error("getBrowserInfo: window or navigator is not available");const{browser:t,browserVersion:n,browserOS:r}=X(navigator.userAgent),e={userAgent:navigator.userAgent,browser:t,browserVersion:n,browserOS:r,language:navigator.language,screenWidth:window.screen.width,screenHeight:window.screen.height,viewportWidth:window.innerWidth||document.documentElement.clientWidth,viewportHeight:window.innerHeight||document.documentElement.clientHeight,pixelRatio:window.devicePixelRatio||1,cookieEnabled:navigator.cookieEnabled};return P=e,e}function K(){return P}function T(t=6,n=8){const r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",e=Math.floor(Math.random()*(n-t+1))+t;let o="";if(typeof crypto<"u"&&crypto.getRandomValues){const i=new Uint8Array(e);crypto.getRandomValues(i);for(let s=0;s<e;s++)o+=r[i[s]%r.length]}else for(let i=0;i<e;i++)o+=r[Math.floor(Math.random()*r.length)];return o}function Y(t){return t.traceId}function G(t){try{const n=K();if(!n){console.warn("wecubeReport: browserInfo not initialized");return}const r=Object.entries(n).map(([i,s])=>`${i}:${s}`).join(";"),e=[{biz_id:19502,time:Math.floor(Date.now()/1e3),uaBrowser:n.browser,uaBrowserVersion:n.browserVersion,uaBrowserOS:n.browserOS,extra:r,sessionId:t==null?void 0:t.sessionId,watermark_id:t==null?void 0:t.traceId}];if(typeof XMLHttpRequest>"u")return;const o=new XMLHttpRequest;o.open("POST",z,!0),o.setRequestHeader("Content-Type","application/json"),o.send(JSON.stringify(e))}catch{}}function Z(t,n,r={}){if(typeof document>"u"){console.warn("setCookie: document is not available");return}const{expires:e,path:o="/",domain:i,secure:s=!1,sameSite:a="Lax"}=r;let c=`${encodeURIComponent(t)}=${encodeURIComponent(n)}`;if(e!==void 0){const d=new Date;d.setTime(d.getTime()+e*24*60*60*1e3),c+=`; expires=${d.toUTCString()}`}o&&(c+=`; path=${o}`),i&&(c+=`; domain=${i}`),s&&(c+="; secure"),a&&(c+=`; samesite=${a}`),document.cookie=c}function A(t){if(!t||t.length===0)throw new Error("文本不能为空");let n=0;for(let e=0;e<t.length;e++)n+=t.charCodeAt(e)*(e+1);const r=n%62;return r<10?String.fromCharCode(r+48):r<36?String.fromCharCode(r+55):String.fromCharCode(r+61)}function J(t){const n=A(t);return t+n}const l=[];for(let t=0;t<256;++t)l.push((t+256).toString(16).slice(1));function Q(t,n=0){return(l[t[n+0]]+l[t[n+1]]+l[t[n+2]]+l[t[n+3]]+"-"+l[t[n+4]]+l[t[n+5]]+"-"+l[t[n+6]]+l[t[n+7]]+"-"+l[t[n+8]]+l[t[n+9]]+"-"+l[t[n+10]]+l[t[n+11]]+l[t[n+12]]+l[t[n+13]]+l[t[n+14]]+l[t[n+15]]).toLowerCase()}let O;const tt=new Uint8Array(16);function et(){if(!O){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");O=crypto.getRandomValues.bind(crypto)}return O(tt)}const U={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function nt(t,n,r){var o;if(U.randomUUID&&!n&&!t)return U.randomUUID();t=t||{};const e=t.random??((o=t.rng)==null?void 0:o.call(t))??et();if(e.length<16)throw new Error("Random bytes length must be >= 16");if(e[6]=e[6]&15|64,e[8]=e[8]&63|128,n){if(r=r||0,r<0||r+16>n.length)throw new RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let i=0;i<16;++i)n[r+i]=e[i];return n}return Q(e)}const I=(t,n,r,e,o)=>`<rect x="${t}" width="${n}" height="${r}" fill="${e}" fill-opacity="${o}"/>
`;function E(t){const{patternId:n,markContent:r,stripeColor:e,stripeOpacity:o,barHeight:i,wideBarWith:s,narrowBarWith:a,xOffset:c=0}=t;let d=0,m="",f={isShort:!0,opacity:o};m+=I(d,2*s,i,e,o),d+=2*s,m+=I(d,a,i,e,0),d+=a,m+=I(d,2*s,i,e,o),d+=2*s;for(let p=0;p<r.length;p++){const y=r.charCodeAt(p).toString(2).padStart(8,"0");for(const g of y){const u=f.opacity===0?o:0,_=g==="0"?f.isShort:!f.isShort,h=_?a:s;m+=I(d,h,i,e,u),d+=h,f={isShort:_,opacity:u}}}m+=I(d,2*s,i,e,0),d+=2*s;const w=c!==0?` patternTransform="translate(${c}, 0)"`:"";return`    <pattern id="${n}" width="${d}" height="${i}" patternUnits="userSpaceOnUse"${w}>
${m}    </pattern>
`}function ot(t){const{patternId:n,markContent:r,textHeight:e,textSpacing:o,textSize:i,textColor1:s,textColor2:a,textOpacity:c,areaHeight:d,barHeight:m,blockSpace:f}=t,w=r,p=w.length*i*.7,y=2*p+o*2,g=m+f+e/2+i/3,u="text-shadow: none !important;";let _=`    <pattern id="${n}" width="${y}" height="${d}" patternUnits="userSpaceOnUse">
`;return _+=`      <text style="${u}" x="0" y="${g}" font-family="Arial" font-size="${i}" fill="${s}" fill-opacity="${c}">${w}</text>
`,_+=`      <text style="${u}" x="${p+o}" y="${g}" font-family="Arial" font-size="${i}" fill="${a}" fill-opacity="${c}">${w}</text>
`,_+=`    </pattern>
`,_}function rt(t){const{width:n,height:r,blockSpace:e,barHeight:o,wideBarWith:i,narrowBarWith:s,textHeight:a,markContent:c,textSpacing:d,textSize:m,opacity:f,color1Rgb:w,color2Rgb:p}=t,y=20,g=20,u=o+e+a+e,_=Math.ceil(r/u);let h=`<svg xmlns="http://www.w3.org/2000/svg" width="${n}" height="${r}">
`;h+=`  <defs>
`,h+=E({patternId:"stripePatternColor0",markContent:c,stripeColor:w,stripeOpacity:f,barHeight:o,wideBarWith:i,narrowBarWith:s,xOffset:0}),h+=E({patternId:"stripePatternColor1",markContent:c,stripeColor:p,stripeOpacity:f,barHeight:o,wideBarWith:i,narrowBarWith:s,xOffset:-50}),h+=E({patternId:"stripePatternColor2",markContent:c,stripeColor:w,stripeOpacity:f,barHeight:o,wideBarWith:i,narrowBarWith:s,xOffset:-100}),h+=E({patternId:"stripePatternColor3",markContent:c,stripeColor:p,stripeOpacity:f,barHeight:o,wideBarWith:i,narrowBarWith:s,xOffset:-150}),h+=ot({patternId:"textPattern",markContent:c,textHeight:a,textSpacing:d,textSize:m,textColor1:w,textColor2:p,textOpacity:f,areaHeight:u,barHeight:o,blockSpace:e}),h+=`  </defs>
`,h+=`  <g transform="translate(${g}, ${y})">
`;for(let W=0;W<_;W++){const $=W*u;if($<r-y){const dt=Math.min(o,r-y-$),lt=`stripePatternColor${W%4}`;h+=`    <rect y="${$}" width="100%" height="${dt}" fill="url(#${lt})"/>
`}}return h+=`    <rect width="100%" height="${r-y}" fill="url(#textPattern)"/>
`,h+=`  </g>
`,h+="</svg>",h}let C,R,b;function it(t,n){const r=rt({markContent:t,width:window.innerWidth,height:window.innerHeight,blockSpace:12,barHeight:2,textHeight:20,textSpacing:0,textSize:14,color1Rgb:"rgb(0,0,0)",color2Rgb:n?"rgb(159, 42, 42)":"rgb(255,255,255)",opacity:n?.9:.004,wideBarWith:3,narrowBarWith:1});try{const e=document.createElement("div");e.id=v,e.style.position="fixed",e.style.inset="0",e.style.zIndex="2147483647",e.style.pointerEvents="none",e.innerHTML=r,document.body.appendChild(e)}catch{V()}}function B(){const t=document.getElementById(v);t&&t.parentNode&&t.parentNode.removeChild(t)}function H(t,n=!1){const{showColor:r=!1,refreshStrategy:e,onMounted:o,onRefresh:i}=t||{},s=F,a=b,c=Y(a);Z(s,c);const d=J(c);it(d,r),n?i==null||i({markInfo:a,cookieKey:s}):(o==null||o({markInfo:a,cookieKey:s}),q()),G({sessionId:a.sessionId,traceId:a.traceId});const m=(e==null?void 0:e.enable)!==!1,f=(e==null?void 0:e.interval)??10;m&&f>0&&at(f)}function st(){if(!(!b||!R))try{B(),b.traceId=T(),H(R,!0)}catch(t){console.error("Watermark refresh error:",t)}}function at(t){D(),C=window.setInterval(()=>{st()},t*1e3)}function D(){C&&(clearInterval(C),C=void 0)}async function M(t){var n,r;V();try{R=t;let e=sessionStorage.getItem(k)||((r=(n=window==null?void 0:window.__wxobs__)==null?void 0:n.sessionInfo)==null?void 0:r.uuid);e||(e=nt(),sessionStorage.setItem(k,e)),b={traceId:T(),sessionId:e},H(t,!1)}catch(e){console.error(e)}}function V(){B(),D(),b=void 0,R=void 0}async function ct(t){const r=["noModule"in document.createElement("script")?"https://dev.weixin.qq.com/platform-console/proxy/assets/tel/px.min.js":"https://dev.weixin.qq.com/platform-console/proxy/assets/tel/px.es5.min.js"];function e(o){return new Promise((i,s)=>{const a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=o,a.onload=()=>i(o),a.onerror=()=>s(new Error("Script load error")),document.head.appendChild(a)})}try{return sessionStorage.setItem("wxobs_start_timestamp",String(Date.now())),await Promise.race(r.map(i=>e(i))),(await new Promise((i,s)=>{window.__startPX&&window.__startPX(t).then(i).catch(s)})).sessionId}catch(o){console.error("Error loading scripts:",o)}}function N(t){var n;(n=window==null?void 0:window.__wxobs__)==null||n.event("obtelemetry_phantom_mark_event",{cookieKey:t.cookieKey,...t.markInfo})}let L=10;async function j(t){t!=null&&t.wxobsParams?(await ct(t.wxobsParams),M({...t.watermarkParams||{},onRefresh:n=>{var r,e;N(n),(e=(r=t.watermarkParams)==null?void 0:r.onRefresh)==null||e.call(r,n)},onMounted:n=>{var r,e;N(n),(e=(r=t.watermarkParams)==null?void 0:r.onMounted)==null||e.call(r,n)}})):M(t==null?void 0:t.watermarkParams),L>0&&(L-=1,setTimeout(()=>{document.getElementById(v)||j(t)},200))}S.enable=j,Object.defineProperty(S,Symbol.toStringTag,{value:"Module"})});
