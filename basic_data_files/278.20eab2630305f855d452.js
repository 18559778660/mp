(window.webpackJsonpMp=window.webpackJsonpMp||[]).push([[278],{3252:function(e,n,t){
/*!
 * @module report
 * @author kael, chriscai
 * @date @DATE
 * Copyright (c) 2014 kael, chriscai
 * Licensed under the MIT license.
 */
var r=function(e){if(e.BJ_REPORT)return e.BJ_REPORT;var n=[],t={},o={id:0,uin:0,url:"",offline_url:"",offline_auto_url:"",ext:null,level:4,ignore:[],random:1,delay:1e3,submit:null,repeat:5,offlineLog:!1,offlineLogExp:5,offlineLogAuto:!1},i={db:null,ready:function(e){var n=this;if(!window.indexedDB||!o.offlineLog)return o.offlineLog=!1,e();if(this.db)setTimeout((function(){e(null,n)}),0);else{var t=window.indexedDB.open("badjs",1);if(!t)return o.offlineLog=!1,e();t.onerror=function(n){return e(n),o.offlineLog=!1,console.log("indexdb request error"),!0},t.onsuccess=function(t){n.db=t.target.result,setTimeout((function(){e(null,n)}),500)},t.onupgradeneeded=function(e){var n=e.target.result;n.objectStoreNames.contains("logs")||n.createObjectStore("logs",{autoIncrement:!0})}}},insertToDB:function(e){this.getStore().add(e)},addLog:function(e){this.db&&this.insertToDB(e)},addLogs:function(e){if(this.db)for(var n=0;n<e.length;n++)this.addLog(e[n])},getLogs:function(e,n){if(this.db){var t=this.getStore().openCursor(),r=[];t.onsuccess=function(t){var o=t.target.result;o?(o.value.time>=e.start&&o.value.time<=e.end&&o.value.id==e.id&&o.value.uin==e.uin&&r.push(o.value),o.continue()):n(null,r)},t.onerror=function(e){return n(e),!0}}},clearDB:function(e){if(this.db){var n=this.getStore();if(e){var t=Date.now()-24*(e||2)*3600*1e3;n.openCursor().onsuccess=function(e){var r=e.target.result;r&&(r.value.time<t||!r.value.time)&&(n.delete(r.primaryKey),r.continue())}}else n.clear()}},getStore:function(){return this.db.transaction("logs","readwrite").objectStore("logs")}},u={isOBJByType:function(e,n){return Object.prototype.toString.call(e)==="[object "+(n||"Object")+"]"},isOBJ:function(e){return"object"===typeof e&&!!e},isEmpty:function(e){return null===e||!u.isOBJByType(e,"Number")&&!e},extend:function(e,n){for(var t in n)e[t]=n[t];return e},processError:function(e){try{if(e.stack){var n=e.stack.match("https?://[^\n]+"),t=(n=n?n[0]:"").match(":(\\d+):(\\d+)");return t||(t=[0,0,0]),{msg:u.processStackMsg(e),rowNum:t[1],colNum:t[2],target:n.replace(t[0],""),_orgMsg:e.toString()}}return e.name&&e.message&&e.description?{msg:JSON.stringify(e)}:e}catch(n){return e}},processStackMsg:function(e){var n=e.stack.replace(/\n/gi,"").split(/\bat\b/).slice(0,9).join("@").replace(/\?[^:]+/gi,""),t=e.toString();return n.indexOf(t)<0&&(n=t+"@"+n),n},isRepeat:function(e){if(!u.isOBJ(e))return!0;var n=e.msg;return(t[n]=(parseInt(t[n],10)||0)+1)>o.repeat}},s=e.onerror;e.onerror=function(n,t,r,o,i){var a=n;i&&i.stack&&(a=u.processStackMsg(i)),u.isOBJByType(a,"Event")&&(a+=a.type?"--"+a.type+"--"+(a.target?a.target.tagName+"::"+a.target.src:""):""),g.push({msg:a,target:t,rowNum:r,colNum:o,_orgMsg:n}),p(),s&&s.apply(e,arguments)};var a=function(e,n){var t=[],r=[],i=[];if(u.isOBJ(e))for(var s in e.level=e.level||o.level,e){var a=e[s];if(!u.isEmpty(a)){if(u.isOBJ(a))try{a=JSON.stringify(a)}catch(e){a="[BJ_REPORT detect value stringify error] "+e.toString()}i.push(s+":"+a),t.push(s+"="+encodeURIComponent(a)),r.push(s+"["+n+"]="+encodeURIComponent(a))}}return[r.join("&"),i.join(","),t.join("&")]},f=[],l=[],c=0,d=function(){if(clearTimeout(c),l.length){var e=o._reportUrl+l.join("&")+"&count="+l.length+"&_t="+ +new Date;if(o.submit)o.submit(e);else(new Image).src=e;c=0,l=[]}},p=function(e){if(o._reportUrl){for(var t,r=Math.random()>=o.random;n.length;){var s=!1,p=n.shift();if(p.msg=(p.msg+""||"").substr(0,500),!u.isRepeat(p)){var g=a(p,l.length);if(u.isOBJByType(o.ignore,"Array"))for(var m=0,v=o.ignore.length;m<v;m++){var h=o.ignore[m];if(u.isOBJByType(h,"RegExp")&&h.test(g[1])||u.isOBJByType(h,"Function")&&h(p,g[1])){s=!0;break}}s||(o.offlineLog&&(o.id,o.uin,t=p,t=u.extend({id:o.id,uin:o.uin,time:new Date-0},t),i.db?i.addLog(t):(i.db||f.length||i.ready((function(e,n){n&&f.length&&(n.addLogs(f),f=[])})),f.push(t))),r||20==p.level||(l.push(g[0]),o.onReport&&o.onReport(o.id,p)))}}e?d():c||(c=setTimeout(d,o.delay))}},g=e.BJ_REPORT={push:function(e){var t=u.isOBJ(e)?u.processError(e):{msg:e};if(o.ext&&!t.ext&&(t.ext=o.ext),t.from||(t.from=location.href),t._orgMsg){var r=t._orgMsg;delete t._orgMsg,t.level=2;var i=u.extend({},t);i.level=4,i.msg=r,n.push(t),n.push(i)}else n.push(t);return p(),g},report:function(e,n){return e&&g.push(e),n&&p(!0),g},info:function(e){return e?(u.isOBJ(e)?e.level=2:e={msg:e,level:2},g.push(e),g):g},debug:function(e){return e?(u.isOBJ(e)?e.level=1:e={msg:e,level:1},g.push(e),g):g},reportOfflineLog:function(){window.indexedDB?i.ready((function(e,n){if(n){var t=new Date-0-24*o.offlineLogExp*3600*1e3,r=new Date-0;n.getLogs({start:t,end:r,id:o.id,uin:o.uin},(function(e,n){var i=document.createElement("iframe");i.name="badjs_offline_"+(new Date-0),i.frameborder=0,i.height=0,i.width=0,i.src="javascript:false;",i.onload=function(){var e=document.createElement("form");e.style.display="none",e.target=i.name,e.method="POST",e.action=o.offline_url||o.url.replace(/badjs$/,"offlineLog"),e.enctype.method="multipart/form-data";var u=document.createElement("input");u.style.display="none",u.type="hidden",u.name="offline_log",u.value=JSON.stringify({logs:n,userAgent:navigator.userAgent,startDate:t,endDate:r,id:o.id,uin:o.uin}),i.contentDocument.body.appendChild(e),e.appendChild(u),e.submit(),setTimeout((function(){document.body.removeChild(i)}),1e4),i.onload=null},document.body.appendChild(i)}))}})):r.info("unsupport offlineLog")},offlineLog:function(e){return e?(u.isOBJ(e)?e.level=20:e={msg:e,level:20},g.push(e),g):g},init:function(e){if(u.isOBJ(e))for(var t in e)o[t]=e[t];var s=parseInt(o.id,10);return s&&(/qq\.com$/gi.test(location.hostname)&&(o.url||(o.url="//badjs2.qq.com/badjs"),o.uin||(o.uin=parseInt((document.cookie.match(/\buin=\D+(\d+)/)||[])[1],10))),o._reportUrl=(o.url||"/badjs")+"?id="+s+"&uin="+o.uin+"&"),n.length&&p(),i._initing||(i._initing=!0,i.ready((function(e,n){n&&setTimeout((function(){n.clearDB(o.offlineLogExp),setTimeout((function(){var e;o.offlineLogAuto&&((e=document.createElement("script")).src=o.offline_auto_url||o.url.replace(/badjs$/,"offlineAuto")+"?id="+o.id+"&uin="+o.uin,window._badjsOfflineAuto=function(e){e&&r.reportOfflineLog()},document.head.appendChild(e))}),5e3)}),1e3)}))),g},__onerror__:e.onerror};return"undefined"!=typeof console&&console.error&&setTimeout((function(){var e=((location.hash||"").match(/([#&])BJ_ERROR=([^&$]+)/)||[])[2];e&&console.error("BJ_ERROR",decodeURIComponent(e).replace(/(:\d+:\d+)\s*/g,"$1\n"))}),0),g}(window);e.exports=r,function(e){if(e.BJ_REPORT){var n=function(n){e.BJ_REPORT.push(n)},t={};e.BJ_REPORT.tryJs=function(e){return e&&(n=e),t};var r,o=function(e,n){for(var t in n)e[t]=n[t]},i=function(e){return"function"==typeof e},u=function(t,o){return function(){try{return t.apply(this,o||arguments)}catch(t){if(n(t),t.stack&&console&&console.error&&console.error("[BJ-REPORT]",t.stack),!r){var i=e.onerror;e.onerror=function(){},r=setTimeout((function(){e.onerror=i,r=null}),50)}throw t}}},s=function(e){return function(){for(var n,t=[],r=0,o=arguments.length;r<o;r++)i(n=arguments[r])&&(n=u(n)),t.push(n);return e.apply(this,t)}},a=function(e){return function(n,t){if("string"==typeof n)try{n=new Function(n)}catch(e){throw e}var r=[].slice.call(arguments,2);return n=u(n,r.length&&r),e(n,t)}},f=function(e,n){return function(){for(var t,r,o=[],s=0,a=arguments.length;s<a;s++)i(t=arguments[s])&&(t.tryWrap?t=t.tryWrap:(r=u(t),t.tryWrap=r,t=r)),o.push(t);return e.apply(n||this,o)}},l=function(e){var n,t;for(n in e)t=e[n],i(t)&&(e[n]=u(t));return e};t.spyJquery=function(){var n,r,o=e.$;if(!o||!o.event)return t;o.zepto?(n=o.fn.on,r=o.fn.off,o.fn.on=f(n),o.fn.off=function(){for(var e,n=[],t=0,o=arguments.length;t<o;t++)i(e=arguments[t])&&e.tryWrap&&(e=e.tryWrap),n.push(e);return r.apply(this,n)}):window.jQuery&&(n=o.event.add,r=o.event.remove,o.event.add=f(n),o.event.remove=function(){for(var e,n=[],t=0,o=arguments.length;t<o;t++)i(e=arguments[t])&&e.tryWrap&&(e=e.tryWrap),n.push(e);return r.apply(this,n)});var u=o.ajax;return u&&(o.ajax=function(e,n){return n||(n=e,e=void 0),l(n),e?u.call(o,e,n):u.call(o,n)}),t},t.spyModules=function(){var n=e.require,r=e.define;return r&&r.amd&&n&&(e.require=s(n),o(e.require,n),e.define=s(r),o(e.define,r)),e.seajs&&r&&(e.define=function(){for(var e,n=[],t=0,o=arguments.length;t<o;t++)i(e=arguments[t])&&((e=u(e)).toString=function(e){return function(){return e.toString()}}(arguments[t])),n.push(e);return r.apply(this,n)},e.seajs.use=s(e.seajs.use),o(e.define,r)),t},t.spySystem=function(){return e.setTimeout=a(e.setTimeout),e.setInterval=a(e.setInterval),t},t.spyCustom=function(e){return i(e)?u(e):l(e)},t.spyAll=function(){return t.spyJquery().spyModules().spySystem(),t}}else console.error("please load bg-report first")}(window)}}]);